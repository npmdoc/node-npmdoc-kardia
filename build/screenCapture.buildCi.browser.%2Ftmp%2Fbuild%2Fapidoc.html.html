<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/pipedrive/kardia">kardia (v0.10.0)</a>
</h1>
<h4>A humane process status API module to expose any operational/internal indicators of any Node.js process for status aggregation and monitoring. JSON format over HTTP protocol.</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.kardia">module kardia</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.start">
            function <span class="apidocSignatureSpan">kardia.</span>start
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status">
            function <span class="apidocSignatureSpan">kardia.</span>status
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker">
            function <span class="apidocSignatureSpan">kardia.</span>worker
            <span class="apidocSignatureSpan">(worker, config)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">kardia.</span>fluentd</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">kardia.</span>status.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">kardia.</span>worker.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kardia.fluentd">module kardia.fluentd</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.fluentd.incrementCounter">
            function <span class="apidocSignatureSpan">kardia.fluentd.</span>incrementCounter
            <span class="apidocSignatureSpan">(config, name, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kardia.status">module kardia.status</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.status">
            function <span class="apidocSignatureSpan">kardia.</span>status
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kardia.status.prototype">module kardia.status.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype._onClusterExit">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>_onClusterExit
            <span class="apidocSignatureSpan">(worker)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype._onClusterFork">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>_onClusterFork
            <span class="apidocSignatureSpan">(worker)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.addWorker">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>addWorker
            <span class="apidocSignatureSpan">(worker)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.clearThroughput">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>clearThroughput
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.decrement">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>decrement
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.emit">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>emit
            <span class="apidocSignatureSpan">(eventName, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.generateStatus">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>generateStatus
            <span class="apidocSignatureSpan">(req)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.getConsulHealthcheck">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>getConsulHealthcheck
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.increment">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>increment
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.log">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>log
            <span class="apidocSignatureSpan">(level, msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.measureFallBehind">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>measureFallBehind
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.on">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>on
            <span class="apidocSignatureSpan">(eventName, handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.registerHealthcheck">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>registerHealthcheck
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.removeListener">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(eventName, handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.removeWorker">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>removeWorker
            <span class="apidocSignatureSpan">(pid)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.reset">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>reset
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.sendCounterToFluentd">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>sendCounterToFluentd
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.serveHealthcheckRequest">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>serveHealthcheckRequest
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.serveStatusRequest">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>serveStatusRequest
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.set">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>set
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.stack">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>stack
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.start">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.startServer">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>startServer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.startStack">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>startStack
            <span class="apidocSignatureSpan">(name, size)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.stopServer">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>stopServer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.stopStack">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>stopStack
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.throughput">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>throughput
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.status.prototype.unset">
            function <span class="apidocSignatureSpan">kardia.status.prototype.</span>unset
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kardia.worker">module kardia.worker</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.worker">
            function <span class="apidocSignatureSpan">kardia.</span>worker
            <span class="apidocSignatureSpan">(worker, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.kardia.worker.prototype">module kardia.worker.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.clearThroughput">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>clearThroughput
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.decrement">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>decrement
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.emit">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>emit
            <span class="apidocSignatureSpan">(eventName, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.generateStatus">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>generateStatus
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.increment">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>increment
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.measureFallBehind">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>measureFallBehind
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.on">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>on
            <span class="apidocSignatureSpan">(eventName, handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.removeListener">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(eventName, handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.reset">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>reset
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.sendCounterToFluentd">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>sendCounterToFluentd
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.set">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>set
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.stack">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>stack
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.startStack">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>startStack
            <span class="apidocSignatureSpan">(name, size)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.stopStack">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>stopStack
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.throughput">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>throughput
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.kardia.worker.prototype.unset">
            function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>unset
            <span class="apidocSignatureSpan">(name, value)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kardia" id="apidoc.module.kardia">module kardia</a></h1>


    <h2>
        <a href="#apidoc.element.kardia.start" id="apidoc.element.kardia.start">
        function <span class="apidocSignatureSpan">kardia.</span>start
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config) {
			if (currentStatus === null) {
				currentStatus = new Status(config);

				if (!currentStatus._instanceId) {
					currentStatus._instanceId = Date.now()+'.'+Math.round(Math.random()*1000);
				}

				currentStatus.on('serverStopped', function() {
					currentStatus = null;
					module.exports = { start: startHandler };
				});

				if (cluster.isMaster) {
					currentStatus.startServer();
				}

				module.exports = currentStatus;
			}
			return currentStatus;
		}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
npm install kardia
```

In your code to start Kardia:

```javascript
var Kardia = require('kardia');
var kardia = Kardia.<span class="apidocCodeKeywordSpan">start</span>({ name: "My process", host: '0.0.0.0',
port: 12900 });
```

Then, when run on the master process, Kardia will create a new HTTP server on the designated host (default 0.0.0.0) and port (default
 12900) which lists the indicators of the running process in JSON format. On the worker process (using Node.js's cluster module
), it will expose the same interface and start collecting data which it sends back to the master process automatically using IPC
 to be displayed with the Kardia HTTP server along with data from the master and all worker processes.

Kardia server will be a singleton, accessible from every file in the master process. So all subsequent calls to Kardia can be to
 obtain the reference to the running server with the following syntax from any file:

```javascript
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status" id="apidoc.element.kardia.status">
        function <span class="apidocSignatureSpan">kardia.</span>status
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Status(config) {
		if (cluster.isMaster &amp;&amp; !config) {
			throw new Error('Kardia cannot start - configuration not supplied');
		}
		if (cluster.isMaster &amp;&amp; !config.name) {
			throw new Error('Kardia cannot start - service name must be supplied');
		}

		this.config = config;
		config.debug = !!config.debug;

		if (cluster.isMaster &amp;&amp; !config.port) {
			this.log('info', 'Kardia starting on default port (12900)');
			config.port = 12900;
		}
		if (cluster.isMaster &amp;&amp; !config.host) {
			this.log('info', 'Kardia starting on default host (0.0.0.0)');
			config.host = '0.0.0.0';
		}

		this.startTime = new Date();
		this.values = {};
		this.counters = {};
		this.throughputs = {};
		this.throughputsBuffer = {};
		this.stacks = {};
		this.healthcheck = null;
		this.healthcheckTimeout = null;
		this.workers = {};
		this.eventListeners = {};
		this.startMemory = process.memoryUsage();
		this.fallBehind = 0;
		this.stackConfig = {};

		this.measureFallBehind();

		if (cluster.isMaster &amp;&amp; config.healthcheck) {
			this.registerHealthcheck(config.healthcheck);
		}

		return this;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker" id="apidoc.element.kardia.worker">
        function <span class="apidocSignatureSpan">kardia.</span>worker
        <span class="apidocSignatureSpan">(worker, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Worker(worker, config) {
		this.pid = worker.process.pid;
		this.id = worker.id;
		this.startTime = new Date();

		this.values = {};
		this.counters = {};
		this.stacks = {};
		this.stackConfig = {};
		this.throughputs = {};
		this.throughputsBuffer = {};
		this.eventListeners = {};

		this.startMemory = process.memoryUsage();
		this.fallBehind = 0;

		this.config = config;

		this.measureFallBehind();

		this.workerMessageListener = worker.on('message', (function workerMessageListenerHandler(msg) {
			if (!msg['~kardia']) {
				return;
			}

			if (msg['~kardia'].cmd &amp;&amp; msg['~kardia'].args &amp;&amp; this[msg['~kardia'].cmd]) {
				this[msg['~kardia'].cmd].apply(this, msg['~kardia'].args);
			}
		}).bind(this));

		return this;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kardia.fluentd" id="apidoc.module.kardia.fluentd">module kardia.fluentd</a></h1>


    <h2>
        <a href="#apidoc.element.kardia.fluentd.incrementCounter" id="apidoc.element.kardia.fluentd.incrementCounter">
        function <span class="apidocSignatureSpan">kardia.fluentd.</span>incrementCounter
        <span class="apidocSignatureSpan">(config, name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">incrementCounter = function (config, name, value) {
		if (!config || !config.name || !config.fluentd || !config.fluentd.host || !config.fluentd.port) {
			return;
		}

		var cache_key = config.name.replace(/[^0-9a-zA-Z]/g, '-') + '.' + name.replace(/[^0-9a-zA-Z]/g, '-') + '.counter';
		cache[cache_key] = (cache[cache_key] || 0) + Number(value);

		if (!started) {
			fluentdConfig = config.fluentd;
			start();
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

	Status.prototype.sendCounterToFluentd = function(name, value) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'sendCounterToFluentd', args: [].slice.call(arguments) } });
			return;
		}

		fluentd.<span class="apidocCodeKeywordSpan">incrementCounter</span>(this.config, name, value);
	};

	Status.prototype.start = function() {
		// dummy wrapper for catching subsequent start calls made by the underlying service using Kardia.
	};

	module.exports = Status;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kardia.status" id="apidoc.module.kardia.status">module kardia.status</a></h1>


    <h2>
        <a href="#apidoc.element.kardia.status.status" id="apidoc.element.kardia.status.status">
        function <span class="apidocSignatureSpan">kardia.</span>status
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Status(config) {
		if (cluster.isMaster &amp;&amp; !config) {
			throw new Error('Kardia cannot start - configuration not supplied');
		}
		if (cluster.isMaster &amp;&amp; !config.name) {
			throw new Error('Kardia cannot start - service name must be supplied');
		}

		this.config = config;
		config.debug = !!config.debug;

		if (cluster.isMaster &amp;&amp; !config.port) {
			this.log('info', 'Kardia starting on default port (12900)');
			config.port = 12900;
		}
		if (cluster.isMaster &amp;&amp; !config.host) {
			this.log('info', 'Kardia starting on default host (0.0.0.0)');
			config.host = '0.0.0.0';
		}

		this.startTime = new Date();
		this.values = {};
		this.counters = {};
		this.throughputs = {};
		this.throughputsBuffer = {};
		this.stacks = {};
		this.healthcheck = null;
		this.healthcheckTimeout = null;
		this.workers = {};
		this.eventListeners = {};
		this.startMemory = process.memoryUsage();
		this.fallBehind = 0;
		this.stackConfig = {};

		this.measureFallBehind();

		if (cluster.isMaster &amp;&amp; config.healthcheck) {
			this.registerHealthcheck(config.healthcheck);
		}

		return this;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kardia.status.prototype" id="apidoc.module.kardia.status.prototype">module kardia.status.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.kardia.status.prototype._onClusterExit" id="apidoc.element.kardia.status.prototype._onClusterExit">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>_onClusterExit
        <span class="apidocSignatureSpan">(worker)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_onClusterExit = function (worker) {
		this.removeWorker(worker.process.pid);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype._onClusterFork" id="apidoc.element.kardia.status.prototype._onClusterFork">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>_onClusterFork
        <span class="apidocSignatureSpan">(worker)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_onClusterFork = function (worker) {
		this.addWorker(worker);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.addWorker" id="apidoc.element.kardia.status.prototype.addWorker">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>addWorker
        <span class="apidocSignatureSpan">(worker)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addWorker = function (worker) {
		if (!worker || !worker.process || !worker.process.pid || !worker.id) {
			throw new Error('PID and ID are required to add a worker process to Kardia');
		}

		this.workers[worker.process.pid] = new Worker(worker, this.config);

		return this.workers[worker.process.pid];
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		consulParams.http = 'http://'+host+':'+this.config.port+'/health?service_name=' + this.config.name
;
		consulParams.service_id = options &amp;&amp; options.service_id || this.config.name;

		return consulParams;
	};

	Status.prototype._onClusterFork = function(worker) {
		this.<span class="apidocCodeKeywordSpan">addWorker</span>(worker);
	};

	Status.prototype._onClusterExit = function(worker) {
		this.removeWorker(worker.process.pid);
	};

	Status.prototype.startServer = function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.clearThroughput" id="apidoc.element.kardia.status.prototype.clearThroughput">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>clearThroughput
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clearThroughput = function (name) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'clearThroughput', args: [].slice.call(arguments) } });
			return;
		}
		delete this.throughputsBuffer[name];
		delete this.throughput[name];

		if (Object.keys(this.throughputInterval).length === 0 &amp;&amp; this.throughputInterval) {
			clearInterval(this.throughputInterval);
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.<span class="apidocCodeKeywordSpan">clearThroughput</span>(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage

```
npm install kardia
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.decrement" id="apidoc.element.kardia.status.prototype.decrement">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>decrement
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">decrement = function (name, value) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'decrement', args: [].slice.call(arguments) } });
			return;
		}
		this.increment(name, -(Number(value) || 1));
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Use the same way across master and worker processes (all workers' statuses get aggregated to master for output automatically
)
* [Built-in support for sending increment based counters to fluentd](#using-kardia-to-report-increments-to-fluentd-via-udp)
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.increment(key, n);](#kardiaincrementkey-n)
* [kardia.<span class="apidocCodeKeywordSpan">decrement</span>(key, n);](#kardiadecrementkey-n)
* [kardia.startStack(name, length);](#kardiastartstackname-length)
* [kardia.stack(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
* [kardia.clearThroughput(name);](#kardiaclearthroughputname)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.emit" id="apidoc.element.kardia.status.prototype.emit">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>emit
        <span class="apidocSignatureSpan">(eventName, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emit = function (eventName, data) {
		if (this.eventListeners[eventName]) {
			this.eventListeners[eventName].forEach(function(listener) {
				listener(data);
			});
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
					var x = this.throughputs[key][this.throughputCalculationStep];
					x.sec = parseInt((this.throughputsBuffer[key] / this.throughputCalculationStep).toFixed(2), 10);
					x.min = parseInt((this.throughputsBuffer[key] * (60 / this.throughputCalculationStep)).toFixed(2), 10);
					x.hour = parseInt((this.throughputsBuffer[key] * (3600 / this.throughputCalculationStep)).toFixed(2), 10);
					this.throughputsBuffer[key] = 0;

				}).bind(this));
				this.<span class="apidocCodeKeywordSpan">emit</span>('throughputIntervalRun');
				
			}).bind(this), 1000 * this.throughputCalculationStep);
		}
	};

	Status.prototype.clearThroughput = function(name) {
		if (cluster.isWorker &amp;&amp; process.send) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.generateStatus" id="apidoc.element.kardia.status.prototype.generateStatus">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>generateStatus
        <span class="apidocSignatureSpan">(req)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateStatus = function (req) {
		var date = new Date(),
			workersData = [];

		Object.keys(this.workers).forEach((function(pid) {
			workersData.push(this.workers[pid].generateStatus());
		}).bind(this));

		var resp = {
			service: this.config.name,
			pid: process.pid,
			env: process.env.NODE_ENV || 'development',
			uptime: Math.floor((date.getTime() - this.startTime.getTime())/1000),
			uptime_formatted: formatTime(Math.floor((date.getTime() - this.startTime.getTime())/1000)),
			startTime: this.startTime.toISOString(),
			curTime: date.toISOString(),
			uid: process.getuid ? process.getuid() : null,
			gid: process.getgid ? process.getgid() : null,
			values: this.values,
			counters: this.counters,
			throughput: this.throughputs,
			stacks: this.stacks,
			workers: workersData,
			remoteAddress: (req &amp;&amp; req.socket &amp;&amp; req.socket.remoteAddress ? req.socket.remoteAddress : false),
			network: os.networkInterfaces(),
			hostname: os.hostname(),
			memory: formatMemory(process.memoryUsage(), this.startMemory),
			fallBehind: this.fallBehind,
			os: {
				type: os.type(),
				platform: os.platform(),
				arch: os.arch(),
				release: os.release(),
				uptime: os.uptime(),
				loadavg: os.loadavg(),
				totalmem: os.totalmem(),
				freemem: os.freemem()
			},
			config: this.config
		};

		return resp;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			this.emit('serverError', err);
			throw new Error('Kardia error + ' + err.stack);
		}).bind(this));
	};

	Status.prototype.serveStatusRequest = function(req, res) {
		res.writeHead(200, {'Content-Type': 'application/json'});
		res.end(JSON.stringify(this.<span class="apidocCodeKeywordSpan">generateStatus</span>(req), false, 4) + '\n');
	};

	Status.prototype.serveHealthcheckRequest = function(req, res) {
		var callbackFired = false,
			checkTimeout;

		var checkSucceeded = function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.getConsulHealthcheck" id="apidoc.element.kardia.status.prototype.getConsulHealthcheck">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>getConsulHealthcheck
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getConsulHealthcheck = function (options) {
		var host = (this.config.host === '0.0.0.0') ? os.hostname() : this.config.host;

		var consulParams = {};
		consulParams.interval = options &amp;&amp; options.interval || '10s';
		consulParams.notes = options &amp;&amp; options.notes || this.config.name + ' Kardia health check';
		consulParams.http = 'http://'+host+':'+this.config.port+'/health?service_name=' + this.config.name;
		consulParams.service_id = options &amp;&amp; options.service_id || this.config.name;

		return consulParams;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        callback(err);
    }
});
```

#### Built-in Consul health check integration

Kardia's health check handler mechanism can be easily used with various monitoring tools, such as [Consul](https://www.consul
.io/docs/agent/checks.html). Furthermore, Kardia comes with a designated method (`kardia.<span class="apidocCodeKeywordSpan">getConsulHealthcheck
</span>()`) for obtaining the health check details for direct Consul integration, using the [consul-node](https://github.com/silas
/node-consul#consulagentserviceregisteroptions-callback) npm module.


Consul integration example (using [consul-node]() npm module):
```javascript
consul.agent.service.register({ name: "my-service", check: kardia.getConsulHealthcheck() }, function(err) {
  if (err) throw err;
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.increment" id="apidoc.element.kardia.status.prototype.increment">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>increment
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">increment = function (name, value) {
		this.sendCounterToFluentd(name, (Number(value) || 1));
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'increment', args: [].slice.call(arguments) } });
			return;
		}
		this.counters[name] = (this.counters[name] || 0) + (Number(value) || 1);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Unified health check endpoint registration (```/health```)
* Use the same way across master and worker processes (all workers' statuses get aggregated to master for output automatically
)
* [Built-in support for sending increment based counters to fluentd](#using-kardia-to-report-increments-to-fluentd-via-udp)
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.<span class="apidocCodeKeywordSpan">increment</span>(key, n);](#kardiaincrementkey-n)
* [kardia.decrement(key, n);](#kardiadecrementkey-n)
* [kardia.startStack(name, length);](#kardiastartstackname-length)
* [kardia.stack(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.log" id="apidoc.element.kardia.status.prototype.log">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>log
        <span class="apidocSignatureSpan">(level, msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (level, msg) {
		switch (level) {
			case 'error':
				if (this.config) process.stderr.write(new Date().toString() + ': ' + msg.toString() + '\n');
				throw new Error(msg.toString());
			default:
				if (this.config &amp;&amp; this.config.debug) process.stdout.write(new Date().toString() + ': ' + (msg ? msg.toString() : msg) + '\n
');
				break;
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			throw new Error('Kardia cannot start - service name must be supplied');
		}

		this.config = config;
		config.debug = !!config.debug;

		if (cluster.isMaster &amp;&amp; !config.port) {
			this.<span class="apidocCodeKeywordSpan">log</span>('info', 'Kardia starting on default port (12900)');
			config.port = 12900;
		}
		if (cluster.isMaster &amp;&amp; !config.host) {
			this.log('info', 'Kardia starting on default host (0.0.0.0)');
			config.host = '0.0.0.0';
		}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.measureFallBehind" id="apidoc.element.kardia.status.prototype.measureFallBehind">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>measureFallBehind
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">measureFallBehind = function () {
		var that = this,
			time = process.hrtime();

		setTimeout(function() {
			var diff = process.hrtime(time);

			that.fallBehind = ((diff[0] - 1) * 1e9 + diff[1]) / 1e6;
			that.measureFallBehind();
		}, 1000);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		this.healthcheckTimeout = null;
		this.workers = {};
		this.eventListeners = {};
		this.startMemory = process.memoryUsage();
		this.fallBehind = 0;
		this.stackConfig = {};

		this.<span class="apidocCodeKeywordSpan">measureFallBehind</span>();

		if (cluster.isMaster &amp;&amp; config.healthcheck) {
			this.registerHealthcheck(config.healthcheck);
		}

		return this;
	}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.on" id="apidoc.element.kardia.status.prototype.on">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>on
        <span class="apidocSignatureSpan">(eventName, handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (eventName, handler) {
		if (!this.eventListeners[eventName]) {
			this.eventListeners[eventName] = [];
		}

		this.eventListeners[eventName].push(handler);

		return true;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			if (currentStatus === null) {
				currentStatus = new Status(config);

				if (!currentStatus._instanceId) {
					currentStatus._instanceId = Date.now()+'.'+Math.round(Math.random()*1000);
				}

				currentStatus.<span class="apidocCodeKeywordSpan">on</span>('serverStopped', function() {
					currentStatus = null;
					module.exports = { start: startHandler };
				});

				if (cluster.isMaster) {
					currentStatus.startServer();
				}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.registerHealthcheck" id="apidoc.element.kardia.status.prototype.registerHealthcheck">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>registerHealthcheck
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">registerHealthcheck = function (options) {
		if (!cluster.isMaster) {
			throw new Error('Kardia health checks can only be registered on the master process as of now.');
		}

		if (typeof options === 'function') {
			options = {
				handler: options,
				timeout: 10
			};
		}

		this.healthcheck = options.handler;
		this.healthcheckTimeout = options.timeout;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.<span class="apidocCodeKeywordSpan">registerHealthcheck</span>({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck
-handler-function-timeout-integer)

## Usage

```
npm install kardia
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.removeListener" id="apidoc.element.kardia.status.prototype.removeListener">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(eventName, handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeListener = function (eventName, handler) {
		if (this.eventListeners[eventName]) {
			this.eventListeners[eventName].splice(this.eventListeners[eventName].indexOf(handler));
		}

		return true;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	Status.prototype.stopServer = function() {
		if (!cluster.isMaster) {
			return false;
		}

		try {
			this.server.close();
			cluster.<span class="apidocCodeKeywordSpan">removeListener</span>('fork', this.onClusterFork);
			cluster.removeListener('exit', this.onClusterExit);
		} catch (e) {
			// ignore.
		}

		this.emit('serverStopped');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.removeWorker" id="apidoc.element.kardia.status.prototype.removeWorker">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>removeWorker
        <span class="apidocSignatureSpan">(pid)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeWorker = function (pid) {
		if (!pid) {
			throw new Error('PID is required to remove a worker process from Kardia');
		}

		delete this.workers[pid];
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	};

	Status.prototype._onClusterFork = function(worker) {
		this.addWorker(worker);
	};

	Status.prototype._onClusterExit = function(worker) {
		this.<span class="apidocCodeKeywordSpan">removeWorker</span>(worker.process.pid);
	};

	Status.prototype.startServer = function() {
		this.onClusterFork = this._onClusterFork.bind(this);
		this.onClusterExit = this._onClusterExit.bind(this);

		cluster.on('fork', this.onClusterFork);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.reset" id="apidoc.element.kardia.status.prototype.reset">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>reset
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reset = function (name) {
    if (cluster.isWorker &amp;&amp; process.send) {
        process.send({ '~kardia': { cmd: 'reset', args: [].slice.call(arguments) } });
        return;
    }
    this.counters[name] = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.sendCounterToFluentd" id="apidoc.element.kardia.status.prototype.sendCounterToFluentd">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>sendCounterToFluentd
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sendCounterToFluentd = function (name, value) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'sendCounterToFluentd', args: [].slice.call(arguments) } });
			return;
		}

		fluentd.incrementCounter(this.config, name, value);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
				process.send({ '~kardia': { cmd: 'unset', args: [].slice.call(arguments) } });
				return;
			}
		}
	};

	Status.prototype.increment = function(name, value) {
		this.<span class="apidocCodeKeywordSpan">sendCounterToFluentd</span>(name, (Number(value) || 1));
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'increment', args: [].slice.call(arguments) } });
			return;
		}
		this.counters[name] = (this.counters[name] || 0) + (Number(value) || 1);
	};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.serveHealthcheckRequest" id="apidoc.element.kardia.status.prototype.serveHealthcheckRequest">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>serveHealthcheckRequest
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serveHealthcheckRequest = function (req, res) {
		var callbackFired = false,
			checkTimeout;

		var checkSucceeded = function() {
			res.writeHead(200, {'Content-Type': 'application/json'});
			res.end(JSON.stringify({
				success: true
			}, false, 4) + '\n');
		};

		var checkFailed = function(err) {
			res.writeHead(500);
			res.end(JSON.stringify({
				success: false,
				error: err.toString()
			}, null, 4) + '\n');
		};

		var callback = function(err) {
			if (callbackFired) {
				return;
			}
			callbackFired = true;

			if (checkTimeout) {
				clearTimeout(checkTimeout);
			}

			if (err) {
				checkFailed(err);
			} else {
				checkSucceeded();
			}
		};

		checkTimeout = function() {
			return callback(new Error('Health check timed out (&gt; ' + this.healthcheckTimeout + ' sec)'));
		};
		
		var parsedUrl = URL.parse(req.url, true);

		if (parsedUrl.query &amp;&amp; parsedUrl.query.service_name &amp;&amp; parsedUrl.query.service_name !== this.config.name) {
			return callback(new Error('Service name mismatch (expected ' + this.config.name + ' but ' + parsedUrl.query.service_name + '
supplied as parameter)'));
		}

		if (this.healthcheckTimeout &gt; 0) {
			checkTimeout = setTimeout(checkTimeout.bind(this), this.healthcheckTimeout * 1000);
		}

		// execute the health check
		if (this.healthcheck &amp;&amp; typeof this.healthcheck === 'function') {
			this.healthcheck(callback, this.generateStatus(req), req, res);
		} else {
			callback(new Error('Health check not registered'));
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		cluster.on('fork', this.onClusterFork);
		cluster.on('exit', this.onClusterExit);

		this.server = http.createServer((function (req, res) {
			this.emit('serverRequest', { req: req });

			if (req.url.substr(0, 7) === '/health') {
				this.<span class="apidocCodeKeywordSpan">serveHealthcheckRequest</span>(req, res);
			} else {
				this.serveStatusRequest(req, res);
			}
		}).bind(this));

		this.server.listen(this.config.port, this.config.host, (function() {
			this.log('info', 'Kardia listening on ' + this.config.host + ':' + this.config.port);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.serveStatusRequest" id="apidoc.element.kardia.status.prototype.serveStatusRequest">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>serveStatusRequest
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serveStatusRequest = function (req, res) {
		res.writeHead(200, {'Content-Type': 'application/json'});
		res.end(JSON.stringify(this.generateStatus(req), false, 4) + '\n');
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

		this.server = http.createServer((function (req, res) {
			this.emit('serverRequest', { req: req });

			if (req.url.substr(0, 7) === '/health') {
				this.serveHealthcheckRequest(req, res);
			} else {
				this.<span class="apidocCodeKeywordSpan">serveStatusRequest</span>(req, res);
			}
		}).bind(this));

		this.server.listen(this.config.port, this.config.host, (function() {
			this.log('info', 'Kardia listening on ' + this.config.host + ':' + this.config.port);
			this.emit('serverListening');
		}).bind(this));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.set" id="apidoc.element.kardia.status.prototype.set">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>set
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (name, value) {
		if (this.values[name] !== value) {
			this.values[name] = value;
			if (cluster.isWorker &amp;&amp; process.send) {
				process.send({ '~kardia': { cmd: 'set', args: [].slice.call(arguments) } });
				return;
			}
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## Methods

 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.<span class="apidocCodeKeywordSpan">set</span>(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.stack" id="apidoc.element.kardia.status.prototype.stack">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>stack
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stack = function (name, value) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'stack', args: [].slice.call(arguments) } });
			return;
		}
		if (!this.stacks[name]) this.startStack(name);
		this.stacks[name].unshift({ time: new Date().toISOString(), value: value });
		this.stacks[name] = this.stacks[name].splice(0, this.stackConfig[name].size);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.increment(key, n);](#kardiaincrementkey-n)
* [kardia.decrement(key, n);](#kardiadecrementkey-n)
* [kardia.startStack(name, length);](#kardiastartstackname-length)
* [kardia.<span class="apidocCodeKeywordSpan">stack</span>(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
* [kardia.clearThroughput(name);](#kardiaclearthroughputname)
* [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout-
integer)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.start" id="apidoc.element.kardia.status.prototype.start">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function () {
		// dummy wrapper for catching subsequent start calls made by the underlying service using Kardia.
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
npm install kardia
```

In your code to start Kardia:

```javascript
var Kardia = require('kardia');
var kardia = Kardia.<span class="apidocCodeKeywordSpan">start</span>({ name: "My process", host: '0.0.0.0',
port: 12900 });
```

Then, when run on the master process, Kardia will create a new HTTP server on the designated host (default 0.0.0.0) and port (default
 12900) which lists the indicators of the running process in JSON format. On the worker process (using Node.js's cluster module
), it will expose the same interface and start collecting data which it sends back to the master process automatically using IPC
 to be displayed with the Kardia HTTP server along with data from the master and all worker processes.

Kardia server will be a singleton, accessible from every file in the master process. So all subsequent calls to Kardia can be to
 obtain the reference to the running server with the following syntax from any file:

```javascript
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.startServer" id="apidoc.element.kardia.status.prototype.startServer">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>startServer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">startServer = function () {
		this.onClusterFork = this._onClusterFork.bind(this);
		this.onClusterExit = this._onClusterExit.bind(this);

		cluster.on('fork', this.onClusterFork);
		cluster.on('exit', this.onClusterExit);

		this.server = http.createServer((function (req, res) {
			this.emit('serverRequest', { req: req });

			if (req.url.substr(0, 7) === '/health') {
				this.serveHealthcheckRequest(req, res);
			} else {
				this.serveStatusRequest(req, res);
			}
		}).bind(this));

		this.server.listen(this.config.port, this.config.host, (function() {
			this.log('info', 'Kardia listening on ' + this.config.host + ':' + this.config.port);
			this.emit('serverListening');
		}).bind(this));

		this.server.on('error', (function(err) {
			this.emit('serverError', err);
			throw new Error('Kardia error + ' + err.stack);
		}).bind(this));
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

				currentStatus.on('serverStopped', function() {
					currentStatus = null;
					module.exports = { start: startHandler };
				});

				if (cluster.isMaster) {
					currentStatus.<span class="apidocCodeKeywordSpan">startServer</span>();
				}

				module.exports = currentStatus;
			}
			return currentStatus;
		};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.startStack" id="apidoc.element.kardia.status.prototype.startStack">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>startStack
        <span class="apidocSignatureSpan">(name, size)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">startStack = function (name, size) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'startStack', args: [].slice.call(arguments) } });
			return;
		}
		this.stacks[name] = [];
		this.stackConfig[name] = { size: Number(size) || 15 };
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* [Built-in support for sending increment based counters to fluentd](#using-kardia-to-report-increments-to-fluentd-via-udp)
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.increment(key, n);](#kardiaincrementkey-n)
* [kardia.decrement(key, n);](#kardiadecrementkey-n)
* [kardia.<span class="apidocCodeKeywordSpan">startStack</span>(name, length);](#kardiastartstackname-length)
* [kardia.stack(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
* [kardia.clearThroughput(name);](#kardiaclearthroughputname)
* [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout-
integer)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.stopServer" id="apidoc.element.kardia.status.prototype.stopServer">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>stopServer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stopServer = function () {
		if (!cluster.isMaster) {
			return false;
		}

		try {
			this.server.close();
			cluster.removeListener('fork', this.onClusterFork);
			cluster.removeListener('exit', this.onClusterExit);
		} catch (e) {
			// ignore.
		}

		this.emit('serverStopped');

		return true;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.stopStack" id="apidoc.element.kardia.status.prototype.stopStack">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>stopStack
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stopStack = function (name) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'stopStack', args: [].slice.call(arguments) } });
			return;
		}
		delete this.stacks[name];
		delete this.stackConfig[name];
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

## Methods

 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.<span class="apidocCodeKeywordSpan">stopStack</span>(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.throughput" id="apidoc.element.kardia.status.prototype.throughput">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>throughput
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">throughput = function (name) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'throughput', args: [].slice.call(arguments) } });
			return;
		}

		if (!this.throughputsBuffer[name]) {
			this.throughputsBuffer[name] = 0;
		}

		this.throughputsBuffer[name]++;

		// the throughput calculation interval time in seconds (will likely be configurable in the future):
		if (!this.throughputCalculationStep) {
			this.throughputCalculationStep = 30;
		}

		if (!this.throughputInterval &amp;&amp; Object.keys(this.throughputsBuffer).length &gt; 0) {

			// set up the appropriate interval to calculate throughput rates per sec, minute, hour
			this.throughputInterval = setInterval((function() {
				Object.keys(this.throughputsBuffer).forEach((function(key) {
					if (!this.throughputs[key]) {
						this.throughputs[key] = {};
					}
					if (!this.throughputs[key][this.throughputCalculationStep]) {
						this.throughputs[key][this.throughputCalculationStep] = {};
					}
					var x = this.throughputs[key][this.throughputCalculationStep];
					x.sec = parseInt((this.throughputsBuffer[key] / this.throughputCalculationStep).toFixed(2), 10);
					x.min = parseInt((this.throughputsBuffer[key] * (60 / this.throughputCalculationStep)).toFixed(2), 10);
					x.hour = parseInt((this.throughputsBuffer[key] * (3600 / this.throughputCalculationStep)).toFixed(2), 10);
					this.throughputsBuffer[key] = 0;

				}).bind(this));
				this.emit('throughputIntervalRun');
				
			}).bind(this), 1000 * this.throughputCalculationStep);
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.<span class="apidocCodeKeywordSpan">throughput</span>(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage

```
npm install kardia
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.status.prototype.unset" id="apidoc.element.kardia.status.prototype.unset">
        function <span class="apidocSignatureSpan">kardia.status.prototype.</span>unset
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unset = function (name, value) {
		if (typeof this.values[name] !== 'undefined') {
			delete this.values[name];
			if (cluster.isWorker &amp;&amp; process.send) {
				process.send({ '~kardia': { cmd: 'unset', args: [].slice.call(arguments) } });
				return;
			}
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.<span class="apidocCodeKeywordSpan">unset</span>(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage

```
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kardia.worker" id="apidoc.module.kardia.worker">module kardia.worker</a></h1>


    <h2>
        <a href="#apidoc.element.kardia.worker.worker" id="apidoc.element.kardia.worker.worker">
        function <span class="apidocSignatureSpan">kardia.</span>worker
        <span class="apidocSignatureSpan">(worker, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Worker(worker, config) {
		this.pid = worker.process.pid;
		this.id = worker.id;
		this.startTime = new Date();

		this.values = {};
		this.counters = {};
		this.stacks = {};
		this.stackConfig = {};
		this.throughputs = {};
		this.throughputsBuffer = {};
		this.eventListeners = {};

		this.startMemory = process.memoryUsage();
		this.fallBehind = 0;

		this.config = config;

		this.measureFallBehind();

		this.workerMessageListener = worker.on('message', (function workerMessageListenerHandler(msg) {
			if (!msg['~kardia']) {
				return;
			}

			if (msg['~kardia'].cmd &amp;&amp; msg['~kardia'].args &amp;&amp; this[msg['~kardia'].cmd]) {
				this[msg['~kardia'].cmd].apply(this, msg['~kardia'].args);
			}
		}).bind(this));

		return this;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.kardia.worker.prototype" id="apidoc.module.kardia.worker.prototype">module kardia.worker.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.clearThroughput" id="apidoc.element.kardia.worker.prototype.clearThroughput">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>clearThroughput
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clearThroughput = function (name) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'clearThroughput', args: [].slice.call(arguments) } });
			return;
		}
		delete this.throughputsBuffer[name];
		delete this.throughput[name];

		if (Object.keys(this.throughputInterval).length === 0 &amp;&amp; this.throughputInterval) {
			clearInterval(this.throughputInterval);
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.<span class="apidocCodeKeywordSpan">clearThroughput</span>(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage

```
npm install kardia
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.decrement" id="apidoc.element.kardia.worker.prototype.decrement">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>decrement
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">decrement = function (name, value) {
		this.increment(name, -(Number(value) || 1));
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Use the same way across master and worker processes (all workers' statuses get aggregated to master for output automatically
)
* [Built-in support for sending increment based counters to fluentd](#using-kardia-to-report-increments-to-fluentd-via-udp)
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.increment(key, n);](#kardiaincrementkey-n)
* [kardia.<span class="apidocCodeKeywordSpan">decrement</span>(key, n);](#kardiadecrementkey-n)
* [kardia.startStack(name, length);](#kardiastartstackname-length)
* [kardia.stack(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
* [kardia.clearThroughput(name);](#kardiaclearthroughputname)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.emit" id="apidoc.element.kardia.worker.prototype.emit">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>emit
        <span class="apidocSignatureSpan">(eventName, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emit = function (eventName, data) {
		if (this.eventListeners[eventName]) {
			this.eventListeners[eventName].forEach(function(listener) {
				listener(data);
			});
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
					var x = this.throughputs[key][this.throughputCalculationStep];
					x.sec = parseInt((this.throughputsBuffer[key] / this.throughputCalculationStep).toFixed(2), 10);
					x.min = parseInt((this.throughputsBuffer[key] * (60 / this.throughputCalculationStep)).toFixed(2), 10);
					x.hour = parseInt((this.throughputsBuffer[key] * (3600 / this.throughputCalculationStep)).toFixed(2), 10);
					this.throughputsBuffer[key] = 0;

				}).bind(this));
				this.<span class="apidocCodeKeywordSpan">emit</span>('throughputIntervalRun');
				
			}).bind(this), 1000 * this.throughputCalculationStep);
		}
	};

	Status.prototype.clearThroughput = function(name) {
		if (cluster.isWorker &amp;&amp; process.send) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.generateStatus" id="apidoc.element.kardia.worker.prototype.generateStatus">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>generateStatus
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateStatus = function () {
		var date = new Date();
		return {
			pid: this.pid,
			startTime: this.startTime,
			uptime: Math.floor((date.getTime() - this.startTime.getTime())/1000),
			values: this.values,
			stacks: this.stacks,
			throughput: this.throughputs,
			counters: this.counters,
			fallBehind: this.fallBehind
		};
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			this.emit('serverError', err);
			throw new Error('Kardia error + ' + err.stack);
		}).bind(this));
	};

	Status.prototype.serveStatusRequest = function(req, res) {
		res.writeHead(200, {'Content-Type': 'application/json'});
		res.end(JSON.stringify(this.<span class="apidocCodeKeywordSpan">generateStatus</span>(req), false, 4) + '\n');
	};

	Status.prototype.serveHealthcheckRequest = function(req, res) {
		var callbackFired = false,
			checkTimeout;

		var checkSucceeded = function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.increment" id="apidoc.element.kardia.worker.prototype.increment">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>increment
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">increment = function (name, value) {
		this.counters[name] = (this.counters[name] || 0) + (Number(value) || 1);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Unified health check endpoint registration (```/health```)
* Use the same way across master and worker processes (all workers' statuses get aggregated to master for output automatically
)
* [Built-in support for sending increment based counters to fluentd](#using-kardia-to-report-increments-to-fluentd-via-udp)
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.<span class="apidocCodeKeywordSpan">increment</span>(key, n);](#kardiaincrementkey-n)
* [kardia.decrement(key, n);](#kardiadecrementkey-n)
* [kardia.startStack(name, length);](#kardiastartstackname-length)
* [kardia.stack(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.measureFallBehind" id="apidoc.element.kardia.worker.prototype.measureFallBehind">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>measureFallBehind
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">measureFallBehind = function () {
		var that = this,
			time = process.hrtime();

		setTimeout(function() {
			var diff = process.hrtime(time);

			that.fallBehind = ((diff[0] - 1) * 1e9 + diff[1]) / 1e6;
			that.measureFallBehind();
		}, 1000).unref();
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		this.healthcheckTimeout = null;
		this.workers = {};
		this.eventListeners = {};
		this.startMemory = process.memoryUsage();
		this.fallBehind = 0;
		this.stackConfig = {};

		this.<span class="apidocCodeKeywordSpan">measureFallBehind</span>();

		if (cluster.isMaster &amp;&amp; config.healthcheck) {
			this.registerHealthcheck(config.healthcheck);
		}

		return this;
	}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.on" id="apidoc.element.kardia.worker.prototype.on">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>on
        <span class="apidocSignatureSpan">(eventName, handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (eventName, handler) {
		if (!this.eventListeners[eventName]) {
			this.eventListeners[eventName] = [];
		}

		this.eventListeners[eventName].push(handler);

		return true;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			if (currentStatus === null) {
				currentStatus = new Status(config);

				if (!currentStatus._instanceId) {
					currentStatus._instanceId = Date.now()+'.'+Math.round(Math.random()*1000);
				}

				currentStatus.<span class="apidocCodeKeywordSpan">on</span>('serverStopped', function() {
					currentStatus = null;
					module.exports = { start: startHandler };
				});

				if (cluster.isMaster) {
					currentStatus.startServer();
				}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.removeListener" id="apidoc.element.kardia.worker.prototype.removeListener">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(eventName, handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeListener = function (eventName, handler) {
		if (this.eventListeners[eventName]) {
			this.eventListeners[eventName].splice(this.eventListeners[eventName].indexOf(handler));
		}

		return true;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	Status.prototype.stopServer = function() {
		if (!cluster.isMaster) {
			return false;
		}

		try {
			this.server.close();
			cluster.<span class="apidocCodeKeywordSpan">removeListener</span>('fork', this.onClusterFork);
			cluster.removeListener('exit', this.onClusterExit);
		} catch (e) {
			// ignore.
		}

		this.emit('serverStopped');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.reset" id="apidoc.element.kardia.worker.prototype.reset">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>reset
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reset = function (name) {
    this.counters[name] = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.sendCounterToFluentd" id="apidoc.element.kardia.worker.prototype.sendCounterToFluentd">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>sendCounterToFluentd
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sendCounterToFluentd = function (name, value) {
		fluentd.incrementCounter(this.config, name, value);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
				process.send({ '~kardia': { cmd: 'unset', args: [].slice.call(arguments) } });
				return;
			}
		}
	};

	Status.prototype.increment = function(name, value) {
		this.<span class="apidocCodeKeywordSpan">sendCounterToFluentd</span>(name, (Number(value) || 1));
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'increment', args: [].slice.call(arguments) } });
			return;
		}
		this.counters[name] = (this.counters[name] || 0) + (Number(value) || 1);
	};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.set" id="apidoc.element.kardia.worker.prototype.set">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>set
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (name, value) {
		this.values[name] = value;
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## Methods

 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.<span class="apidocCodeKeywordSpan">set</span>(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.stack" id="apidoc.element.kardia.worker.prototype.stack">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>stack
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stack = function (name, value) {
		if (!this.stacks[name]) this.startStack(name);
		this.stacks[name].unshift({ time: new Date().toISOString(), value: value });
		this.stacks[name] = this.stacks[name].splice(0, this.stackConfig[name].size);
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.increment(key, n);](#kardiaincrementkey-n)
* [kardia.decrement(key, n);](#kardiadecrementkey-n)
* [kardia.startStack(name, length);](#kardiastartstackname-length)
* [kardia.<span class="apidocCodeKeywordSpan">stack</span>(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
* [kardia.clearThroughput(name);](#kardiaclearthroughputname)
* [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout-
integer)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.startStack" id="apidoc.element.kardia.worker.prototype.startStack">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>startStack
        <span class="apidocSignatureSpan">(name, size)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">startStack = function (name, size) {
		this.stacks[name] = [];
		this.stackConfig[name] = { size: Number(size) || 15 };
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* [Built-in support for sending increment based counters to fluentd](#using-kardia-to-report-increments-to-fluentd-via-udp)
* [Integration with Consul HTTP based health checks](#built-in-consul-health-check-integration)

## Methods

* [kardia.increment(key, n);](#kardiaincrementkey-n)
* [kardia.decrement(key, n);](#kardiadecrementkey-n)
* [kardia.<span class="apidocCodeKeywordSpan">startStack</span>(name, length);](#kardiastartstackname-length)
* [kardia.stack(name, value);](#kardiastackname-value)
* [kardia.stopStack(name);](#kardiastopstackname)
* [kardia.set(key, value);](#kardiasetkey-value)
* [kardia.unset(key);](#kardiaunsetkey)
* [kardia.throughput(name);](#kardiathroughputname)
* [kardia.clearThroughput(name);](#kardiaclearthroughputname)
* [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout-
integer)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.stopStack" id="apidoc.element.kardia.worker.prototype.stopStack">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>stopStack
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stopStack = function (name) {
		delete this.stacks[name];
		delete this.stackConfig[name];
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

## Methods

 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.<span class="apidocCodeKeywordSpan">stopStack</span>(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.throughput" id="apidoc.element.kardia.worker.prototype.throughput">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>throughput
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">throughput = function (name) {
		if (cluster.isWorker &amp;&amp; process.send) {
			process.send({ '~kardia': { cmd: 'throughput', args: [].slice.call(arguments) } });
			return;
		}

		if (!this.throughputsBuffer[name]) {
			this.throughputsBuffer[name] = 0;
		}

		this.throughputsBuffer[name]++;

		// the throughput calculation interval time in seconds (will likely be configurable in the future):
		if (!this.throughputCalculationStep) {
			this.throughputCalculationStep = 30;
		}

		if (!this.throughputInterval &amp;&amp; Object.keys(this.throughputsBuffer).length &gt; 0) {

			// set up the appropriate interval to calculate throughput rates per sec, minute, hour
			this.throughputInterval = setInterval((function() {
				Object.keys(this.throughputsBuffer).forEach((function(key) {
					if (!this.throughputs[key]) {
						this.throughputs[key] = {};
					}
					if (!this.throughputs[key][this.throughputCalculationStep]) {
						this.throughputs[key][this.throughputCalculationStep] = {};
					}
					var x = this.throughputs[key][this.throughputCalculationStep];
					x.sec = parseInt((this.throughputsBuffer[key] / this.throughputCalculationStep).toFixed(2), 10);
					x.min = parseInt((this.throughputsBuffer[key] * (60 / this.throughputCalculationStep)).toFixed(2), 10);
					x.hour = parseInt((this.throughputsBuffer[key] * (3600 / this.throughputCalculationStep)).toFixed(2), 10);
					this.throughputsBuffer[key] = 0;

				}).bind(this));
				this.emit('throughputIntervalRun');
				
			}).bind(this), 1000 * this.throughputCalculationStep);
		}
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.unset(key);](#kardiaunsetkey)
 * [kardia.<span class="apidocCodeKeywordSpan">throughput</span>(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage

```
npm install kardia
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.kardia.worker.prototype.unset" id="apidoc.element.kardia.worker.prototype.unset">
        function <span class="apidocSignatureSpan">kardia.worker.prototype.</span>unset
        <span class="apidocSignatureSpan">(name, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unset = function (name, value) {
		delete this.values[name];
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

 * [kardia.increment(key, n);](#kardiaincrementkey-n)
 * [kardia.decrement(key, n);](#kardiadecrementkey-n)
 * [kardia.startStack(name, length);](#kardiastartstackname-length)
 * [kardia.stack(name, value);](#kardiastackname-value)
 * [kardia.stopStack(name);](#kardiastopstackname)
 * [kardia.set(key, value);](#kardiasetkey-value)
 * [kardia.<span class="apidocCodeKeywordSpan">unset</span>(key);](#kardiaunsetkey)
 * [kardia.throughput(name);](#kardiathroughputname)
 * [kardia.clearThroughput(name);](#kardiaclearthroughputname)
 * [kardia.registerHealthcheck({ handler: (function), timeout: (integer)});](#kardiaregisterhealthcheck-handler-function-timeout
-integer)

## Usage

```
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>